<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" type="image/svg+xml" href="./favicon.svg">
    <!-- 方法1：iframe（会显示在结构树） -->
<iframe src="./5e9f26d7acb09d42c5a15076bc34bf29.txt" style="display:none;"></iframe>

<!-- 方法2：fetch（网络面板可见） -->
<script>
fetch('./5e9f26d7acb09d42c5a15076bc34bf29.txt').then(r => r.text()).then(console.log);
</script>

    <title>新年小惊喜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        /* 字体定义 - 增加兼容性 */
        @font-face {
            font-family: "AlimamaDFDK";
            src: url("./fonts/AlimamaDongFangDaKai-Regular.woff2") format("woff2"),
                 url("./fonts/AlimamaDongFangDaKai-Regular.woff") format("woff");
            font-display: swap;
        }

        html, body {
            font-family: "AlimamaDFDK", "PingFang SC", "Microsoft YaHei", "Noto Sans CJK SC", sans-serif;
            overflow: hidden;
            width: 100%;
            height: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 容器 */
        .container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        /* 第二层 - 自动判断深浅模式 */
        .back-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            z-index: 1;
            -webkit-transition: background-color 0.3s;
            transition: background-color 0.3s;
        }

        /* 浅色模式 */
        @media (prefers-color-scheme: light) {
            .back-layer {
                background: #ffffff;
                color: #1a1a1a;
            }
        }

        /* 深色模式 */
        @media (prefers-color-scheme: dark) {
            .back-layer {
                background: #0a0a0a;
                color: #ffffff;
            }
        }

        /* 烟花画布 */
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        /* 图片容器 - 响应式 */
        .images-wrapper {
            position: relative;
            width: 90vw;
            max-width: 500px;
            height: auto;
            aspect-ratio: 2 / 1;
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            margin-top: 5vh;
        }

        .card {
            width: 100%;
            height: 100%;
            object-fit: contain;
            -webkit-user-select: none;
            user-select: none;
        }

        .top-text {
            margin-bottom: 0;
            font-size: clamp(1rem, 4vw, 1.5rem);
            text-align: center;
            padding: 0 20px;
            word-wrap: break-word;
        }

        /* 重置按钮 */
        .reset-btn {
            margin-top: 5vh;
            padding: 12px 24px;
            background: transparent;
            border: 2px solid currentColor;
            color: inherit;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(0.9rem, 3.5vw, 1rem);
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .reset-btn:hover, .reset-btn:active {
            background: currentColor;
        }

        @media (prefers-color-scheme: light) {
            .reset-btn:hover, .reset-btn:active {
                color: #fff;
            }
        }
        @media (prefers-color-scheme: dark) {
            .reset-btn:hover, .reset-btn:active {
                color: #000;
            }
        }

        /* 第一层 */
        .front-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #dc2626;
            background: -webkit-linear-gradient(135deg, #dc2626 0%, #991b1b 50%, #7f1d1d 100%);
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 50%, #7f1d1d 100%);
            display: -webkit-box;
            display: -webkit-flex;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            flex-direction: column;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            justify-content: center;
            -webkit-box-align: center;
            -webkit-align-items: center;
            align-items: center;
            z-index: 2;
            -webkit-transition: -webkit-transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.6s;
        }

        .front-layer.push-out {
            -webkit-transform: translateY(-100%);
            transform: translateY(-100%);
            opacity: 0;
        }

        .text-container {
            margin-bottom: 5vh;
            padding: 0 5vw;
            max-width: 90vw;
            width: 100%;
            text-align: left;
        }

        .text-container p {
            color: #fef2f2;
            font-size: clamp(1rem, 4vw, 1.5rem);
            line-height: 1.8;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            word-wrap: break-word;
        }

        .push-btn {
            padding: 3vw 8vw;
            max-width: 200px;
            width: 60vw;
            background: #fbbf24;
            color: #7c2d12;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: clamp(1rem, 4vw, 1.2rem);
            -webkit-box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            -webkit-transition: all 0.3s;
            transition: all 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        .push-btn:hover, .push-btn:active {
            -webkit-transform: translateY(-2px);
            transform: translateY(-2px);
            -webkit-box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4);
            background: #f59e0b;
        }

        /* 小屏幕优化 */
        @media (max-height: 600px) {
            .images-wrapper {
                margin-top: 3vh;
            }
            .reset-btn {
                margin-top: 3vh;
            }
            .text-container {
                margin-bottom: 3vh;
            }
        }

        /* 横屏优化 */
        @media (orientation: landscape) and (max-height: 500px) {
            .images-wrapper {
                width: 50vw;
                max-width: 300px;
            }
            .text-container p {
                font-size: clamp(0.9rem, 3vh, 1.2rem);
            }
        }
    </style>
</head>
<body>

<canvas id="fireworks"></canvas>

<div class="container">
    <div class="back-layer" id="backLayer">
        <div class="top-text">
            <p>试试切换手机深浅模式吧</p>
        </div>
        
        <div class="images-wrapper">
            <img src="./card.png" alt="" class="card" ondragstart="return false;">
        </div>

        <button class="reset-btn" onclick="reset()">返回</button>
    </div>

    <div class="front-layer" id="frontLayer">
        <div class="text-container">
            <p>转眼，2025蛇年已至尽头，我们马上就要迎来崭新的2026马年<br>过去的一年千千万万诉不尽，<br>将到的一年日日夜夜梦可成，<br>让我们共同启封这个惊喜！</p>
        </div>
        
        <button class="push-btn" onclick="pushOut()">进入</button>
    </div>
</div>

<script>
    // 兼容性检查
    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = window.webkitRequestAnimationFrame || 
                                       window.mozRequestAnimationFrame || 
                                       function(callback) { setTimeout(callback, 16); };
    }

    if (!window.localStorage) {
        window.localStorage = {
            getItem: function() { return null; },
            setItem: function() {},
            removeItem: function() {}
        };
    }

    // 页面加载检查
    window.addEventListener('load', function() {
        try {
            if (localStorage.getItem('layer') === 'second') {
                var front = document.getElementById('frontLayer');
                if (front) {
                    front.classList.add('push-out');
                    setTimeout(startFireworks, 100);
                }
            }
        } catch(e) {}
    });

    // 烟花系统
    var canvas = document.getElementById('fireworks');
    var ctx = canvas.getContext('2d');
    var fireworks = [];
    var particles = [];
    var isRunning = false;

    function resizeCanvas() {
        var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
        canvas.width = w;
        canvas.height = h;
    }
    resizeCanvas();

    var resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(resizeCanvas, 100);
    });

    var colorSchemes = [
        [0, 60, 120, 180],
        [240, 280, 320, 360],
        [30, 90, 150, 210],
        [300, 340, 20, 80]
    ];

    function Firework() {
        var w = canvas.width;
        var h = canvas.height;
        this.x = Math.random() * w;
        this.y = h;
        this.targetY = Math.random() * h * 0.3 + Math.min(50, h * 0.1);
        this.speed = 6 + Math.random() * 4;
        this.angle = -Math.PI / 2 + (Math.random() - 0.5) * 0.5;
        this.vx = Math.cos(this.angle) * this.speed;
        this.vy = Math.sin(this.angle) * this.speed;
        var scheme = colorSchemes[Math.floor(Math.random() * colorSchemes.length)];
        this.hue = scheme[Math.floor(Math.random() * scheme.length)] + Math.random() * 20 - 10;
        this.exploded = false;
        this.trail = [];
        this.trailLength = 8;
    }

    Firework.prototype.update = function() {
        this.trail.push({x: this.x, y: this.y});
        if (this.trail.length > this.trailLength) {
            this.trail.shift();
        }
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.15;
        if (this.vy >= 0 || this.y <= this.targetY) {
            this.explode();
        }
    };

    Firework.prototype.explode = function() {
        this.exploded = true;
        var count = 25 + Math.floor(Math.random() * 20);
        for (var i = 0; i < count; i++) {
            particles.push(new Particle(this.x, this.y, this.hue));
        }
    };

    Firework.prototype.draw = function() {
        for (var i = 0; i < this.trail.length; i++) {
            var point = this.trail[i];
            var alpha = (i / this.trail.length) * 0.8;
            var size = (i / this.trail.length) * 3;
            ctx.beginPath();
            ctx.arc(point.x, point.y, size, 0, Math.PI * 2);
            ctx.fillStyle = 'hsla(' + this.hue + ', 100%, 60%, ' + alpha + ')';
            ctx.fill();
        }
        ctx.beginPath();
        ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
        ctx.fillStyle = 'hsl(' + this.hue + ', 100%, 70%)';
        ctx.shadowBlur = 10;
        ctx.shadowColor = 'hsl(' + this.hue + ', 100%, 50%)';
        ctx.fill();
        ctx.shadowBlur = 0;
    };

    function Particle(x, y, hue) {
        this.x = x;
        this.y = y;
        var angle = Math.random() * Math.PI * 2;
        var speed = Math.random() * 6 + 2;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
        this.hue = hue + Math.random() * 40 - 20;
        this.life = 1;
        this.decay = Math.random() * 0.015 + 0.01;
        this.gravity = 0.08;
        this.trail = [];
        this.trailLength = 5;
    }

    Particle.prototype.update = function() {
        this.trail.push({x: this.x, y: this.y});
        if (this.trail.length > this.trailLength) {
            this.trail.shift();
        }
        this.x += this.vx;
        this.y += this.vy;
        this.vy += this.gravity;
        this.vx *= 0.98;
        this.life -= this.decay;
    };

    Particle.prototype.draw = function() {
        for (var i = 0; i < this.trail.length; i++) {
            var point = this.trail[i];
            var alpha = (i / this.trail.length) * this.life * 0.6;
            ctx.beginPath();
            ctx.arc(point.x, point.y, 1.5, 0, Math.PI * 2);
            ctx.fillStyle = 'hsla(' + this.hue + ', 100%, 60%, ' + alpha + ')';
            ctx.fill();
        }
        ctx.save();
        ctx.globalAlpha = this.life;
        ctx.beginPath();
        ctx.arc(this.x, this.y, 2.5, 0, Math.PI * 2);
        ctx.fillStyle = 'hsl(' + this.hue + ', 100%, 65%)';
        ctx.shadowBlur = 6;
        ctx.shadowColor = 'hsl(' + this.hue + ', 100%, 50%)';
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.restore();
    };

    var fireworkCount = 0;
    var maxFireworks = 3;
    var animateId = null;

    function animate() {
        if (!isRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (fireworkCount < maxFireworks && Math.random() < 0.02) {
            fireworks.push(new Firework());
            fireworkCount++;
        }
        
        var i;
        for (i = fireworks.length - 1; i >= 0; i--) {
            var fw = fireworks[i];
            if (!fw.exploded) {
                fw.update();
                fw.draw();
            } else {
                fireworks.splice(i, 1);
            }
        }
        
        for (i = particles.length - 1; i >= 0; i--) {
            var p = particles[i];
            p.update();
            p.draw();
            if (p.life <= 0) {
                particles.splice(i, 1);
            }
        }
        
        if (fireworks.length === 0 && particles.length === 0 && fireworkCount >= maxFireworks) {
            setTimeout(function() {
                fireworkCount = 0;
            }, 500 + Math.random() * 1000);
        }
        
        animateId = requestAnimationFrame(animate);
    }

    function startFireworks() {
        if (isRunning) return;
        isRunning = true;
        fireworkCount = 0;
        animate();
    }

    function stopFireworks() {
        isRunning = false;
        if (animateId) cancelAnimationFrame(animateId);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        fireworks = [];
        particles = [];
        fireworkCount = 0;
    }

    function pushOut() {
        var front = document.getElementById('frontLayer');
        if (front) {
            front.classList.add('push-out');
            try {
                localStorage.setItem('layer', 'second');
            } catch(e) {}
            setTimeout(startFireworks, 300);
        }
    }

    function reset() {
        var front = document.getElementById('frontLayer');
        if (front) {
            front.classList.remove('push-out');
            try {
                localStorage.removeItem('layer');
            } catch(e) {}
            stopFireworks();
        }
    }

    // 页面可见性变化处理
    document.addEventListener('visibilitychange', function() {
        if (document.hidden && isRunning) {
            // 页面隐藏时暂停，节省资源
        } else if (!document.hidden && localStorage.getItem('layer') === 'second') {
            // 页面显示时恢复
            if (!isRunning) startFireworks();
        }
    });
</script>

</body>
</html>
